#!/bin/sh

set -x  # Print commands and their arguments as they are executed.
# the %h for shortened commit ids can't be used
commits="$(git --git-dir=$dev/guix/.git log --pretty=format:%H master..dev)"
{ retval="$?"; set +x; } 2>/dev/null

printf "Commits to authenticate:\n"
for cid in $commits; do
    printf "    %s\n" $cid
done

for cid in $commits; do
    set -x  # Print commands and their arguments as they are executed.
    guix git authenticate --cache-key=channels/guix --stats --repository=$dev/guix $cid \
         "\"A2FE D89D 9A10 000E 5BF6  3B37 612D 3636 8877 DC81\""
         # "\"5D02 7CEF 97C8 FE6D E393  70BD 9403 F3A0 D4BA FE08\""
    { retval="$?"; set +x; } 2>/dev/null
done
